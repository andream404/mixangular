// **************************************************************************
// Copyright 2007 - 2008 The JSLab Team, Tavs Dokkedahl and Allan Jacobs
// Contact: http://www.jslab.dk/contact.php
//
// This file is part of the JSLab Standard Library (JSL) Program.
//
// JSL is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 3 of the License, or
// any later version.
//
// JSL is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program. If not, see <http://www.gnu.org/licenses/>.
// ***************************************************************************
// File created 2009-02-01 00:29:35

Cookie.decode=decodeURIComponent;Array.prototype.copy=function(){return[].concat(this);};Array.prototype.diff=function(){var a1=this;var a=a2=null;var n=0;while(n<arguments.length){a=[];a2=arguments[n];var l=a1.length;var l2=a2.length;var diff=true;for(var i=0;i<l;i++){for(var j=0;j<l2;j++){if(a1[i]===a2[j]){diff=false;break;}}diff?a.push(a1[i]): diff=true;}a1=a;n++;}return a.unique();};Array.prototype.disjoint=function(){var args=[];var l=arguments.length;if(!l)return true;for(var i=0;i<l;i++)args.push(arguments[i]);return Array.prototype.intersect.apply(this,args).length>0?false : true;};Array.prototype.intersect=function(){if(!arguments.length)return[];var a1=this;var a=a2=null;var n=0;while(n<arguments.length){a=[];a2=arguments[n];var l=a1.length;var l2=a2.length;for(var i=0;i<l;i++){for(var j=0;j<l2;j++){if(a1[i]===a2[j])a.push(a1[i]);}}a1=a;n++;}return a.unique();};Array.prototype.mapFunction=function(f){var l=this.length;for(var i=0;i<l;i++)f(this[i]);};Array.prototype.mapMethod=function(m){var a=[];for(var i=1;i<arguments.length;i++)a.push(arguments[i]);var l=this.length;for(var i=0;i<l;i++)m.apply(this[i],a);};Array.prototype.pad=function(s,v){var l=Math.abs(s)-this.length;var a=[].concat(this);if(l<=0)return a;for(var i=0;i<l;i++)s<0?a.unshift(v): a.push(v);return a;};Array.prototype.randomize=function(ru){if(!ru)this.sort(function(){return((Math.random()*3)|0)-1;});else{var a=[].concat(this);var l=this.length;var al=n=0;for(var i=0;i<l;i++){al=a.length;n=Math.floor((Math.random()*al));this[i]=a[n];if(n==al-1)a.pop();else{a[n]=a[al-1];a.pop();}}}};Array.prototype.remove=function(f){if(!f)f=function(i){return i==undefined||i==null?true : false;};var l=this.length;var n=0;for(var i=0;i<l;i++)f(this[i])?n++: this[i-n]=this[i];this.length=this.length-n;};Array.prototype.union=function(){var a=[].concat(this);var l=arguments.length;for(var i=0;i<l;i++){a=a.concat(arguments[i]);}return a.unique();};Array.prototype.unique=function(){var a=[];var l=this.length;for(var i=0;i<l;i++){for(var j=i+1;j<l;j++){if(this[i]===this[j])j=++i;}a.push(this[i]);}return a;};Cookie.valueSeparator=':';function Cookie(name,age,path,domain,secure){this.$name=name;this.$age=age?age : 0;this.$date=(new Date()).getTime();this.$path=path?path : window.location.pathname.replace(/(\/)[^\/]*$/,'$1');this.$domain=domain?domain : window.location.hostname;this.$secure=secure?secure : false;}Cookie.encode=encodeURIComponent;Cookie.isEnabled=function(){var c=new Cookie('test');c.write();try{Cookie.read('test');}catch(e){return false;}c.remove();return true;};Cookie.read=function(name){var pos=document.cookie.indexOf(name+'=');if(pos!=-1){var c=new Cookie(name);var s=pos+name.length+1;var e=document.cookie.indexOf(';',s);if(e!=-1)var p=document.cookie.substring(s,e);else var p=document.cookie.substring(s);var a=Cookie.decode(p).split(Cookie.pairSeparator);var t=null;for(var i=0;i<a.length;i++){t=a[i].split(Cookie.valueSeparator);c[t[0]]=t[1];}return c;}else throw new Error('Cookie: No cookie with name \''+name+'\' found.');};Cookie.prototype.remove=function(){this.$age=(new Date()).getTime()/-1000;this.write();};Cookie.prototype.toString=function(){var d=new Date(this.$date*1);var e=new Date(this.$date*1+this.$age*1000);var s='Name: '+this.$name+'\nCreated: '+d+'\nMax-age: '+this.$age+'\nExpires on: '+e+'\nPath: '+this.$path+'\nDomain: '+this.$domain+'\nSecure: '+this.$secure+'\n\n';for(var p in this){if(this[p].constructor!=Function&&p.charAt(0)!='$')s+=p+': '+this[p]+'\n';}return s;};Cookie.prototype.write=function(){var s='';for(var p in this)s+=this[p].constructor!=Function?p+Cookie.valueSeparator+this[p]+Cookie.pairSeparator : '';s=Cookie.encode(s.substring(0,s.length-1));var d=(new Date()).getTime()+this.$age*1000;d=(new Date(d)).toUTCString();document.cookie=this.$name+'='+s+';expires='+d+';max-age='+this.$age+';path='+this.$path+';domain='+this.$domain+';'+this.$secure+';';};Date.nameOfMonths=['January','February','March','April','May','June','July','August','September','October','November','December'];Date.getFirstDateInWeek=function(y,w){var d=(new Date(y,0,4)).getISODay()-1;return new Date(y,0,4-d+(w-1)*7);};Date.prototype.format=function(s,utc){s=s.split('');var l=s.length;var r='';var n=m=null;for(var i=0;i<l;i++){switch(s[i]){case 'd': n=utc?this.getUTCDate(): this.getDate();if(n*1<10)r+='0';r+=n;break;case 'D': r+=this.getNameOfDay(utc).substring(0,3);break;case 'j': r+=utc?this.getUTCDate(): this.getDate();break;case 'l': r+=this.getNameOfDay(utc);break;case 'N': r+=this.getISODay(utc);break;case 'S': r+=this.getDaySuffix(utc);break;case 'w': r+=utc?this.getUTCDay(): this.getDay();break;case 'z': n=0;m=utc?this.getUTCMonth(): this.getMonth();for(var i=0;i<m;i++)n+=Date.daysInMonth[i]if(this.isLeapYear())n++;n+=utc?this.getUTCDate(): this.getDate();n--;r+=n;break;case 'W': r+=this.getISOWeek(utc);break;case 'F': r+=this.getNameOfMonth(utc);break;case 'm': n=utc?this.getUTCMonth(): this.getMonth();n++;if(n<10)r+='0';r+=n;break;case 'M': r+=this.getNameOfMonth(utc).substring(0,3);break;case 'n': n=utc?this.getUTCMonth(): this.getMonth();r+=++n;break;case 't': r+=this.getDaysInMonth(utc);break;case 'L': if(this.isLeapYear(utc))r+='1';else r+='0';break;case 'Y': r+=utc?this.getUTCFullYear(): this.getFullYear();break;case 'y': n=utc?this.getUTCFullYear(): this.getFullYear();r+=(n+'').substring(2);break;case 'a': n=utc?this.getUTCHours(): this.getHours();r+=n<12?'am' : 'pm';break;case 'A': n=utc?this.getUTCHours(): this.getHours();r+=n<12?'AM' : 'PM';break;case 'g': n=utc?this.getUTCHours(): this.getHours();if(n>12)n-=12;r+=n;break;case 'G': r+=this.getHours();break;case 'h': n=utc?this.getUTCHours(): this.getHours();if(n>12)n-=12;if(n<10)r+='0';r+=n;break;case 'H': n=utc?this.getUTCHours(): this.getHours();if(n<10)r+='0';r+=n;break;case 'i': n=utc?this.getUTCMinutes(): this.getMinutes();if(n<10)r+='0';r+=n;break;case 's': n=utc?this.getUTCSeconds(): this.getSeconds();if(n<10)r+='0';r+=n;break;case 'u': r+=utc?this.getUTCMilliseconds(): this.getMilliseconds();break;case 'I': if(this.getMinutes()!=this.getUTCMinutes)r+='1';else r+='0';break;case 'O': n=this.getTimezoneOffset()/60;if(n>=0)r+='+';else r+='-';n=Math.abs(n);if(Math.abs(n)<10)r+='0';r+=n+'00';break;case 'P': n=this.getTimezoneOffset()/60;if(n>=0)r+='+';else r+='-';n=Math.abs(n);if(Math.abs(n)<10)r+='0';r+=n+':00';break;case 'Z': r+=this.getTimezoneOffset()*60;break;case 'c': r+=this.format('Y-m-d',utc)+'T'+this.format('H:i:sP',utc);break;case 'r': r+=this.format('D,j M Y H:i:s P',utc);break;case 'U': r+=this.getTime();break;default: r+=s[i];}}return r};Date.prototype.getDaySuffix=function(utc){var n=utc?this.getUTCDate(): this.getDate();if(n!=11&&(n+'').match(/1$/))return 'st';else if(n!=12&&(n+'').match(/2$/))return 'nd';else if(n!=13&&(n+'').match(/3$/))return 'rd';else return 'th';};Date.prototype.getDaysInMonth=function(utc){var m=utc?this.getUTCMonth(): this.getMonth();if(m==1)return this.isLeapYear()?29 : 28;return(m==3||m==5||m==8||m==10)?30 : 31;};Date.prototype.getISODay=function(utc){var d=utc?this.getUTCDay(): this.getDay();return d?d : 7;};Date.prototype.getISOWeek=function(utc){var y=utc?this.getUTCFullYear(): this.getFullYear();var m=utc?this.getUTCMonth()+1: this.getMonth()+1;var d=utc?this.getUTCDate(): this.getDate();if(m<3){var a=y-1;var b=(a/4|0)-(a/100|0)+(a/400|0);var c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);var s=b-c;var e=0;var f=d-1+31*(m-1);}else{var a=y;var b=(a/4|0)-(a/100|0)+(a/400|0);var c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);var s=b-c;var e=s+1;var f=d+((153*(m-3)+2)/5|0)+58+s;}var g=(a+b)%7;var d=(f+g-e)%7;var n=f+3-d;if(n<0)var w=53-((g-s)/5|0);else if(n>364+s)var w=1;else var w=(n/7|0)+1;return w;};Date.prototype.getNameOfDay=function(utc){var d=this.getISODay(utc)-1;return Date.nameOfDays[d];};Date.prototype.getNameOfMonth=function(utc){var m=utc?this.getUTCMonth(): this.getMonth();return Date.nameOfMonths[m];};Date.prototype._getTimezoneOffset=Date.prototype.getTimezoneOffset;Date.prototype.getTimezoneOffset=function(){return this._getTimezoneOffset()*-1;};Date.prototype.isLeapYear=function(utc){var y=utc?this.getUTCFullYear(): this.getFullYear();return!(y%4)&&(y%100)||!(y%400)?true : false;};Date.prototype.setISOWeek=function(w,utc){var y=utc?this.getUTCFullYear(): this.getFullYear();var d=Date.getFirstDateInWeek(y,w);this.setTime(d.getTime());};Function.prototype.defer=function(n,o){var a=[];for(var i=2;i<arguments.length;i++)a.push(arguments[i]);var that=this;window.setTimeout(function(){return that.apply(o,a);},n);};Function.prototype.getArguments=function(){var m=this.toString().match(/\((.*)\)/)[1];m=m.replace(/\s*/g,'');return m.split(',');};Function.prototype.getBody=function(){var m=this.toString().match(/\{([\s\S]*)\}/m)[1];return m.replace(/^\s*\/\/.*$/mg,'');};Function.prototype.getName=function(){var m=this.toString().match(/^function\s(\w+)/);return m?m[1]: "anonymous";};Function.prototype.time=function(n,obj){if(n<1)return;var o={f:this,a:[],n:n,mean:0,s:0,sd: 0};for(var i=2;i<arguments.length;i++)o.a.push(arguments[i]);var t1,t2;var t=ts=0;for(var i=0;i<n;i++){t1=new Date();this.apply(obj,o.a);t2=(new Date())-t1;t+=t2;ts+=t2*t2;}o.mean=t/n;o.s=n>1?(ts-t*o.mean)/(n-1): 0;o.sd=Math.sqrt(o.s);o.toString=function(){return 'Running '+this.f.getName()+' '+this.n+' times:\n\nMean:\t'+(this.mean).toFixed(8)+'\nVariance:\t'+(this.s).toFixed(8)+'\nSD:\t'+(this.sd).toFixed(8);};return o;};Math.fibonacci=function(n){var g=(1+Math.sqrt(5))/2;return Math.round((Math.pow(g,n)-Math.pow(-g,-n))/Math.sqrt(5));};function logN(x,b){if(b==2)return Math.LOG2E*Math.log(x);if(b==10)return Math.LOG10E*Math.log(x);return Math.log(x)/Math.log(b);};Math.nRoot=function(x,n){var y=Math.log(x)/n;return Math.pow(Math.E,y);};Math.randomN=function(n){return(Math.random()*(n+1))|0;};Number.prototype.isFloat=function(){return/\./.test(this.toString());};Number.prototype.isInteger=function(){return Math.floor(this)==this?true : false;};Number.prototype.toHex=function(){if(!this.isInteger())throw new Error('Number is not an integer');var d=this;var q=r=null var s='';do{q=Math.floor(d/16);r=d%16;s=r<10?r+s : String.fromCharCode(r+55)+s;d=q;}while(q)return s;};String.prototype.br2nl=function(){return this.replace(/<br\s*\/?>/mg,"\n");};String.prototype.levenshtein=function(t){var si;var c;var n=this.length;var m=t.length;if(!n)return m;if(!m)return n;var mx=[];for(var i=0;i<=n;i++){mx[i]=[];mx[i][0]=i;}for(var j=0;j<=m;j++)mx[0][j]=j;for(var i=1;i<=n;i++){si=this.charAt(i-1);for(var j=1;j<=m;j++)mx[i][j]=Math.min(mx[i-1][j]+1,mx[i][j-1]+1,mx[i-1][j-1]+(si==t.charAt(j-1)?0 : 1));}return mx[n][m];};String.prototype.nbsp2s=function(){return this.replace(/ ?/mg," ");};String.prototype.substrCount=function(s){return this.length&&s?(this.split(s)).length-1 : 0;};String.prototype.trimAll=function(){return this.replace(/^\s+|(\s+(?!\S))/mg,"");};String.prototype.trimLeft=function(){return this.replace(/^\s+/,"");};String.prototype.trimRight=function(){return this.replace(/\s+$/,"");};HTMLElement.prototype.insertAfter=function(newNode,refNode){return refNode.nextSibling?this.insertBefore(newNode,refNode.nextSibling): this.appendChild(newNode);};Cookie.valueSeparator='&';HTMLElement.prototype.getPosition=function(){var o={x:0,y:0};var n=this;do{o.x+=n.offsetLeft;o.y+=n.offsetTop;n=n.offsetParent;}while(n)return o;};Function.prototype.setErrorHandler=function(f,v){if(!f)throw new Error('Function.setErrorHandler: No function provided.');var that=this;var g=function(){try{var a=[];for(var i=0;i<arguments.length;i++)a.push(arguments[i]);that.apply(null,a);}catch(e){return f(g,e,v);}};g.old=this;return g;};XHR.isEnabled=function(){return XHR.factory?true : false;};Date.nameOfDays=['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];String.prototype.trim=function(){return this.replace(/^\s+(.*?)\s+$/,'$1');};XHR.prototype.retry=function(){this._onretry();};function XHR(timeout,retries){if(!XHR.factory)throw new Error('XHR: XMLHttpRequest not supported');this.req=XHR.factory();this._readyState=XHR.READYSTATE_UNINITIALIZED;this.aborted=false;var that=this;this.req.onreadystatechange=function(){that._onreadystatechange();};this.timeout=timeout?timeout : 30000;this.timeoutRef=null;this.retryParams={};this.retries=retries?retries : 0;}XHR.ridCounter=0;XHR.READYSTATE_UNINITIALIZED=0;XHR.READYSTATE_OPEN=1;XHR.READYSTATE_SENT=2;XHR.READYSTATE_RECIEVING=3;XHR.READYSTATE_LOADED=4;(function(){try{new XMLHttpRequest();XHR.factory=function(){return new XMLHttpRequest();};}catch(e){try{new ActiveXObject("Msxml2.XMLHTTP");XHR.factory=function(){return new ActiveXObject("Msxml2.XMLHTTP");};}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP");XHR.factory=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}catch(e){XHR.factory=null;}}}})();XHR.prototype._onreadystatechange=function(){if(this._readyState==XHR.READYSTATE_OPEN&&this.req.readyState==XHR.READYSTATE_OPEN)return;this._readyState=this.req.readyState;if(this.req.readyState==XHR.READYSTATE_LOADED&&this.aborted)return;switch(this.req.readyState){case XHR.READYSTATE_UNINITIALIZED: this.aborted=false;break;case XHR.READYSTATE_OPEN: this.rid=XHR.ridCounter++;if(this.onreadystateopen)this.onreadystateopen();break;case XHR.READYSTATE_SENT: break;case XHR.READYSTATE_RECIEVING: if(this.onreadystaterecieving)this.onreadystaterecieving();break;case XHR.READYSTATE_LOADED: if(this.timeoutRef){window.clearTimeout(this.timeoutRef);this.timeoutRef=null;}this.time=(new Date()).getTime()-this.time;if(this.onreadystateloaded)this.onreadystateloaded();this.breakRef();break default: break;}};XHR.prototype.breakRef=function(){this.req.onreadystatechange=null;this.req=null;};XHR.prototype._ontimeout=function(){this.abort();this.timeoutRef=null;if(this.ontimeout)this.ontimeout();if(this.retries>0)this.retry();};XHR.prototype._onretry=function(){this.retries--;if(this.onretry)this.onretry();this.reset();this.open(this.retryParams.method,this.retryParams.url,this.retryParams.async,this.retryParams.username,this.retryParams.password);this.send(this.retryParams.body);};XHR.prototype._onabort=function(){this.aborted=true;this.req.abort();if(this.onabort)this.onabort();};XHR.prototype.reset=function(){this.breakRef();this.aborted=false;this._readyState=XHR.READYSTATE_UNINITIALIZED;this.req=XHR.factory();var that=this;this.req.onreadystatechange=function(){that._onreadystatechange();};};XHR.prototype.open=function(method,url,async,username,password){this.retryParams.method=method;this.retryParams.url=url;this.retryParams.async=async;this.retryParams.username=username;this.retryParams.password=password;this.req.open(method,url,async,username,password);};XHR.prototype.send=function(body){if(body===undefined)body=null;this.retryParams.body=body;this.time=(new Date()).getTime();var that=this;this.timeoutRef=window.setTimeout(function(){that._ontimeout();},this.timeout);this.req.send(body);if(this.onreadystatesent)this.onreadystatesent();};XHR.prototype.abort=function(){this._onabort();};XHR.prototype.getAllResponseHeaders=function(){return this.req.getAllResponseHeaders();};XHR.prototype.getResponseHeader=function(s){return this.req.getResponseHeader(s);};XHR.prototype.setRequestHeader=function(p,v){return this.req.setRequestHeader(p,v);};XHR.prototype.toString=function(){var s='XHR Info\n--------\n';s+='rid: '+this.rid+'\n';s+='timeout: '+this.timeout+'\n';s+='retries: '+this.retries+'\n';s+='time: '+this.time+'\n';s+='aborted: '+this.aborted+'\n';s+='method: '+this.retryParams.method+'\n';s+='url: '+this.retryParams.url+'\n';s+='async: '+this.retryParams.async+'\n';s+='username: '+this.retryParams.username+'\n';s+='password: '+this.retryParams.password+'\n';s+='body: '+this.retryParams.body+'\n';s+='readyState: '+this.req.readyState+'\n';return s;};Function.prototype.removeErrorHandler=function(){return this.old?this.old : this;};Error.lineSeparator='\n-----------------------\n';Error.getStackTrace=function(f,e,ver){var stack='';if(document.createEventObject){var j=0;var tmp=dump=null;var a=null;while(f){stack+='Stack count: '+(j++)+'\nFunction: ';if(ver>0){a=f.getArguments();dump='';tmp='';for(var i=0;i<a.length;i++){if(!a[i])a[i]='arg'+i;if(f.arguments&&f.arguments[i]!==undefined){if(f.arguments[i].constructor==String)tmp+=a[i]+':\''+f.arguments[i]+'\',';else if(f.arguments[i].constructor==Number||f.arguments[i].constructor==Boolean||f.arguments[i]===null)tmp+=a[i]+':'+f.arguments[i]+',';else if(f.arguments[i].constructor)tmp+=a[i]+':['+f.arguments[i].constructor.getName+'],';else if(f.arguments[i].srcElement!==undefined)tmp+=a[i]+':window.event,';else{tmp+=a[i]+':n/a,';if(ver>2){dump+='Enumeration of '+a[i]+':\n';for(var p in f.arguments[i])dump+=p+': '+f.arguments[i][p]+'\n';}}}else tmp+=a[i]+':undefined,';}stack+=f.getName()+'('+tmp.substring(0,tmp.length-2)+')\n';stack+=dump;}else stack+=f.getName();if(ver>1||(ver>0&&f.getName()=='anonymous')){stack+=f.getBody();}stack+=Error.Separator;f=f.caller;}}else if(e.stack)stack=e.stack+Error.Separator;else if(e.stacktrace)stack=e.stacktrace+Error.Separator;else stack="Unavailable"+Error.Separator;return "Stacktrace"+Error.Separator+stack;};Error.report=function(func,error,ver){ver=ver!==undefined?ver : 1;var evt=null;if(func.arguments&&func.arguments[0]&&func.arguments[0].eventPhase!==undefined)evt=func.arguments[0];else if(window.event)evt=window.event;var s='';try{s='Error info'+Error.Separator;s+='Name: '+error.name+'\n';s+='Message: '+error.message+'\n';s+='File: '+Error.getFilename(error);s+='Line: '+Error.getLinenumber(error)+Error.Separator;s+=Error.getClientInfo(ver);s+=Error.getStackTrace(func,error,ver);s+=Error.getEventInfo(evt,ver);}catch(e){s='An error occured in the error handler itself. To avoid endless recursion the error handler is terminating.'+(s?'\nDumping available information on initial error:'+Error.Separator+s : '');}return 'JSLab Error Report GPLv3(http://www.jslab.dk/library.error.php)\nVerbosity level: '+ver+Error.Separator+s+'End of error report.';};Error.getFilename=function(e){var s='';if(e.fileName)s+=e.fileName;else if(e.sourceURL)s+=e.sourceURL;else if(e.stacktrace){var m=e.message.match(/in\s+(.*?\:\/\/\S+)/m);if(m&&m[1])s+=m[1];else s+='Couldn\'t extract filename from message. See error message for filename.';}else s+=location.href+'(unreliable)';return s+'\n';};Error.getLinenumber=function(e){var s='';if(e.lineNumber)s+=e.lineNumber+'';else if(e.line)s+=e.line;else s+='Unavailable. Try message for details.';return s+'\n';};Error.getClientInfo=function(ver){var s='Client'+Error.lineSeparator;if(ver<1)s+='User agent: '+window.navigator.userAgent+Error.lineSeparator;else s+='Enumeration of window.navigator:\n'+Error.Enumerate(window.navigator,ver);return s;};Error.getEventInfo=function(e,ver){var s='Event object'+Error.lineSeparator;if(e){if(e.constructor)s+='Event class: '+e+'\n';else s+='Event class: Unavailable\n';if(!e.target)e.target=e.srcElement;if(ver<1){s+='Event type: '+e.type+'\n';s+='Event target(tag name): '+e.target.nodeName+Error.lineSeparator;}if(ver>0){var n=e.target;var tmp='';var a=[];while(n){tmp=n.nodeName;if(n.id)tmp+='#'+n.id;if(n.className)tmp+='.'+n.className.replace(/\s/g,'___')+'';a.push(tmp);n=n.parentNode;}a.reverse();a=a.join('->');s+='Event target path: '+a+'\n';}if(ver>1){s+='Enumeration of event target:\n'+Error.Enumerate(e.target,ver);s+='Enumeration of Event object:\n'+Error.Enumerate(e,ver);}else s+=Error.lineSeparator;}else s+='Unavailable'+Error.Enumerate(e,ver);return s;};Error.Enumerate=function(obj,ver){var s='';for(var p in obj){if(ver>3)s+=p+': '+obj[p]+'\n';else if(ver>2&&!(obj[p]&&typeof obj[p]=='function'&&/native\s+code/im.test(obj[p])))s+=p+': '+obj[p]+'\n';else if(!(obj[p]&&typeof obj[p]=='function'))s+=p+': '+obj[p]+'\n';}return s+Error.lineSeparator;};HTMLElement.prototype.hasScrollbars=function(){this.scrollLeft++;this.scrollTop++;var d=0;if(this.scrollLeft>0&&this.scrollTop>0)d=3;else if(this.scrollLeft>0)d=1;else if(this.scrollTop>0)d=2;this.scrollLeft--;this.scrollTop--;return d;};HTMLFieldSetElement.prototype.disable=function(b){var c=this.getElementsByTagName('input');var l=c.length;for(var i=0;i<l;i++)c[i].disabled=b;};HTMLElement.prototype.getNodesByType=function getTextNodes(nodeType){var a=[];var l=this.childNodes.length;for(var i=0;i<l;i++){if(this.childNodes[i].nodeType==nodeType)a.push(this.childNodes[i]);if(this.childNodes[i].nodeType==1)a=a.concat(this.childNodes[i].getNodesByType(nodeType));}return a;};Date.parse=function(s,rd){if(!s)return new Date();s=s.replace(/^\s+|\s+$/g,"");if(!rd)rd=new Date();var t='';for(var p in Date.parse.keywords)t+=p+'|';t=t.substring(0,t.length-1);var rgx=new RegExp(t,'i');if(rgx.test(s))return Date.parse.relative(s,rd);else return Date.parse.absolute(s,rd);};Date.parse.absolute=function(s,rd){var r=null,y=null,m=null,d=null,h=null,mi=null,se=null,ms=null;if(r=s.match(/^(\d{4}|\d{2})-(\d{1,2})-(\d{1,2})/)){y=r[1]*1;m=r[2]*1-1;d=r[3]*1;}else if(r=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4}|\d{2})/)){m=r[1]*1-1;d=r[2]*1;y=r[3]*1;}else if(r=s.match(/^(\d{1,2})(\s*|-)([a-z]{3,})((\s+|-)(\d{4}|\d{2}))?/i)){d=r[1]*1;var rgx=new RegExp('^'+r[3],'i');for(var i=0;i<11;i++){if(rgx.test(Date.nameOfMonths[i])){m=i;break;}}if(m===null)throw new Error('Date.parse: Unknown month specified litteraly');if(r[6])y=r[6]*1;}if(y<100)y=y>68&&y<100?1900+y : 2000+y;else if(y&&(y<1972||y>2068))throw new Error('Date.parse: Year out of range. Valid input is 1972 through 2068');if(m&&(m<0||m>11))throw new Error('Date.parse: Month out of range. Valid input is 01 through 12');if(d&&(d<1||d>31))throw new Error('Date.parse: Date out of range. Valid input is 01 through 31');if(y)rd.setFullYear(y);if(m!==null)rd.setMonth(m);if(d)rd.setDate(d);if(r=s.match(/(\d{1,2})\:(\d{1,2})(?:(?:\:(\d{1,2})(?:\.(\d{1,3}))?)?(?:\s*(am|pm)?))?/)){h=r[1]*1;if(r[5]){if(h<1||h>12)throw new Error('Date.parse: Hour out of range(using am/pm). Valid input is 1 through 12');if(r[5]=='am'){if(h==12)h=0;}else{if(h!=12)h=h+12;}}else{if(h>24)throw new Error('Date.parse: Hour out of range. Valid input is 00 through 23');}if(r[2]){mi=r[2]*1;if(mi>59)throw new Error('Date.parse: Minute out of range. Valid input is 00 through 59');}if(r[3]){se=r[3]*1;if(se>59)throw new Error('Date.parse: Seconds out of range. Valid input is 00 through 59');}if(r[4]){ms=Math.ceil(('1.'+r[4])*1000)-1000;}}if(h!==null)rd.setHours(h);if(mi!==null)rd.setMinutes(mi);if(se!==null)rd.setSeconds(se);if(ms!==null)rd.setMilliseconds(ms);return rd;};Date.parse.relative=function(s,rd){if(/^now|today|tomorrow|fortnight|yesterday$/.test(s)){rd.setDate(rd.getDate()+Date.parse.keywords[s]);}else{var mod;var p=/(last|this|next|first|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth|eleventh|twelfth|(?:[\+-]?\d+))\s+([a-z]+)(?:\s+(ago))?/g;while((r=p.exec(s))!=null){if(/(?:[\+-]?\d+)/.test(r[1]))mod=!r[3]?parseInt(r[1]):-1*parseInt(r[1]);else mod=Date.parse.keywords[r[1]];r[2]=r[2].replace(/s$/,'').toLowerCase();switch(r[2]){case 'year': rd.setFullYear(rd.getFullYear()+mod);break;case 'month': rd.setMonth(rd.getMonth()+mod);break;case 'week': rd.setDate(rd.getDate()+mod*7);break;case 'day': rd.setDate(rd.getDate()+mod);break;case 'hour': rd.setHours(rd.getHours()+mod);break;case 'minute': rd.setMinutes(rd.getMinutes()+mod);break;case 'second': rd.setSeconds(rd.getSeconds()+mod);break;default: var rgx=new RegExp('^'+r[2],'i');for(var i=0;i<7;i++){if(rgx.test(Date.nameOfDays[i]))break;}if(i<7){var d=rd.getISODay()-1;if(i>d)rd.setDate(rd.getDate()+(i-d)+((mod-1)*7));else rd.setDate(rd.getDate()+(i-d)+((mod-1)*7)+7);}else throw new Error('Date.parse: Unknown keyword in input');break;}}}return rd;};Date.parse.keywords={now: 0,today: 0,tomorrow: 1,fortnight: 14,yesterday:-1,last:-1,'this': 1,next: 1,first: 1,third: 3,fourth: 4,fifth: 5,sixth: 6,seventh: 7,eighth: 8,ninth: 9,tenth: 10,eleventh: 11,twelfth: 12,second: null,minute: null,hour: null,day: null,week: null,month: null,year: null};Function.prototype.memoize=function(){if(!this.results)this.results={};var args=Array.prototype.slice.call(arguments);if(this.results[args])return this.results[args];this.results[args]=this.apply(null,args);return this.results[args];};